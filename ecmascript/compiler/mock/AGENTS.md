# ecmascript/compiler/mock

Provides a mock `.an` stub payload used in test configurations where the real stub compilation is not needed, enabling faster test builds and isolated testing of runtime components.
Primary Language: C++

## Design

The runtime normally loads precompiled stubs from a stub `.an` file generated by `stub_compiler`. For testing, this module provides `mock_stub_an.cpp` which supplies a minimal, deterministic stub payload.

```
  Normal path:     stub_compiler → builds real stubs → stub .an file
  Test/mock path:  mock_stub_an.cpp → provides dummy payload → libark_mock_stub_set
```

The build system selects between `libark_stub_set` (real) and `libark_mock_stub_set` (mock) depending on the build target. Test targets link against the mock to avoid a dependency on the full stub compilation.

## Key Files

| File | Role |
|------|------|
| `mock_stub_an.cpp` | Mock .an stub payload for test builds |

## How to Modify

If the stub file format changes (e.g., new sections or metadata), update `mock_stub_an.cpp` to match the new expected format so tests continue to load successfully.

## Building

Standalone repo (from repo root `../../`):
```bash
python ark.py x64.debug
```

Full OHOS tree:
```bash
./build.sh --product-name <product-name> --build-target ark_js_host_linux_tools_packages
```

## Tests

Run all unit tests: `python ark.py x64.debug unittest` (from repo root `../../`)

Mock behavior is validated indirectly through:
- Compiler tests: `ecmascript/compiler/tests/`
- Runtime tests that use `libark_mock_stub_set`

## Boundaries

- Keep mock artifacts deterministic and minimal — they exist only to satisfy load-time expectations.
- Never add production compiler logic here.
- When stub formats change, update mock to stay compatible (tests will fail otherwise).
